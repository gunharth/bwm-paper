\chapter{Concepts \& Technical Implementation}
This chapter provides a detailed look at the required concepts and the technical implementation of the PWA. The project has been open-sourced to allow verification of the results\footnote{\url{https://github.com/gunharth/bwm}}. Further, the application is available online\footnote{\url{https://bwm.gunicode.com}}.

\section{Requirements}

The following section outlines the concepts and requirements used for the project by looking at the core functionality of the original \textit{Beer with Me} app.

\textbf{Progressive Web App}. The functional clone of the \textit{Beer with Me} app must implement all relevant techniques as outlined by the Progressive Web App specifications. Technologies include Service Workers, Application Shell (AppShell), Web App Manifest and serving the demo installation over HTTPS. Further, it is the intention to follow the 10 principal concepts, which lay the foundation for Progressive Web Applications, as closely as possible: Progressive, Responsive, Installable, Connectivity Independent, App-Like, Fresh, Safe, Discoverable, Re-engageable and Linkable \citep{osmaniGettingStartedProgressive2015}.

\textbf{Authentication and Authorization}. Users must be able to register for the service with a combination of E-Mail and Password. As an alternative an existing Google account may be used in order to login directly.

\textbf{Realtime Database}. Data is stored in a cloud-hosted database and synchronized in realtime to every connected client.

\textbf{Realtime Notifications}. If enabled by the user push-notifications shall be send to the user in realtime, whenever a new user registers for the service or when a new post was published by a user.

\textbf{Realtime Map}. If enabled by the user his/her current geolocation is saved and displayed on an online map.

\textbf{Single Page App (SPA)}. The app shall be implemented as a Single Page App with one of the main JavaScript frameworks (React, Angular or Vue.js).

Option to add a photo using the deviceâ€™s camera


Frontend, Backend framework/system
straight forward deployment process

The following topics were defined as being not part of the requirements, as they do not have an impact on the used technologies of the PWA, nor do they have an effect on the results of this study. Hence, design considerations of the application can be neglected, nor is the intention to copy the interface and design of the original \textit{Beer with Me} app. The resulting PWA focusses on the implementation of the functionality and not on offering a identical clone of the original. Further, all functions are implemented as a proof-of-concept following the MVP spirit \citep{wikipediaMinimumViableProduct2019}. Thus, to make it a user centric production ready PWA further development cycles are required.


\section{Technical Implementation of Requirements}
As per the actual implementation of the PWA the goal was to base the solution on the least different providers on the one hand, as well as a minimum in terms of coding and programming languages. Hence, the front-end of the application uses the basic building blocks of regular web sites being HTML, CSS and JavaScript in form of the JavaScript framework Vue.js. To satisfy the back-end Firebase was picked as the sole solution provider.

\subsection{Single Page App (SPA) \& Progressive Web App}
For the development of the frontend the JavaScript framework Vue.js\footnote{\url{https://vuejs.org}} and its ecosystem was used. The Vue Cli\footnote{\url{https://cli.vuejs.org}} offers great tooling support for Vue.js developments - among other features it comes with a preset for installing a Progressive Web App skeleton.

\begin{lstlisting}[language=bash, caption=Installation and project creation commands with the Vue Cli, label=lst:vue-cli]
  $ npm install -g @vue/cli
  $ vue create beerwithme
\end{lstlisting}

On project creation Vue Cli offers you to manually select the features that will be installed. Next to Progressive Web Application support the Vue Router and Vuex was installed. The Router enables navigation services within a SPA and Vuex is responsible for the management of state within the application.

\fig{img/vue_project_creation}{Installation options for a Vue.js project}{fig:vue-project-creation}{1}

The Vue Cli PWA support comes with Workbox\footnote{\url{https://developers.google.com/web/tools/workbox}} installed - a library developed by Google for adding offline support to web applications. Among other features it mainly helps with the automatic creation and management of application pre-cache and the App Shell .

\begin{lstlisting}[language=JavaScript, caption=Service Worker with Workbox and Firebase specific initiation (firebase-messaging-sw.js), label=lst:serviceworker]
  importScripts("https://www.gstatic.com/firebasejs/5.6.0/firebase-app.js");
  importScripts("https://www.gstatic.com/firebasejs/5.6.0/firebase-messaging.js");

  self.__precacheManifest = [].concat(self.__precacheManifest || []);
  workbox.precaching.suppressWarnings();
  workbox.precaching.precacheAndRoute(self.__precacheManifest, {});

  workbox.routing.registerRoute(
    new RegExp(
      "https://firebasestorage.googleapis.com/v0/b/bmwgunicode.appspot.com/.*"
    ),
    workbox.strategies.staleWhileRevalidate()
  );

  firebase.initializeApp({
    messagingSenderId: "ID"
  });

\end{lstlisting}

For the front-end design of the app Vuetify\footnote{\url{https://vuetifyjs.com}} was used. Vuetify is a responsive design component framework for Vue.js based on the material design\footnote{\url{https://material.io}} guidelines developed by Google.

\begin{lstlisting}[language=bash, caption=Command to add Vuetify to the Vue.js project, label=lst:vuetify]
  $ vue add vuetify
\end{lstlisting}

The map functionality was implemented by using the npm package vue2-leaflet\footnote{\url{https://www.npmjs.com/package/vue2-leaflet}}, which is a Vue wrapper library for the open-source JavaScript library Leaflet\footnote{\url{https://leafletjs.com}}. Map tiles are served from OpenStreetMap\footnote{\url{https://www.openstreetmap.org}}.
\\

\begin{figure}
  \centering
  \begin{subfigure}{.5\textwidth}
    \centering
    \includegraphics[width=.7\linewidth]{img/screen01}
    \caption{Login screen}
    \label{fig:sub1}
  \end{subfigure}%
  \begin{subfigure}{.5\textwidth}
    \centering
    \includegraphics[width=.7\linewidth]{img/screen02}
    \caption{Main app screen}
    \label{fig:sub2}
  \end{subfigure}
  \begin{subfigure}{.5\textwidth}
    \centering
    \includegraphics[width=.7\linewidth]{img/screen04}
    \caption{New post screen with photo option}
    \label{fig:sub1}
  \end{subfigure}%
  \begin{subfigure}{.5\textwidth}
    \centering
    \includegraphics[width=.7\linewidth]{img/screen03}
    \caption{The map}
    \label{fig:sub2}
  \end{subfigure}
  \caption{Screenshots showing Vuetifys' material design components and the map}
  \label{fig:test}
\end{figure}
\pagebreak

Figure 3 shows the Lighthouse\footnote{\url{https://developers.google.com/web/tools/lighthouse}} Progressive Web App report for the \textit{Beer with Me} PWA.
\fig{img/lighthouse_test}{Lighthouse report}{fig:lighthouse}{1}


\subsection{Cloud Provider and Realtime Functionalities}

To cater for the back-end requirements I picked Firebase\footnote{\url{https://firebase.google.com}} as the provider. Around the same time in 2015, when the term Progressive Web Apps was born, Google acquired this San Francisco start-up. Since then Google has expanded upon the original service and integrated it closely into their other cloud ambitions - whereby the Firebase service is dedicated to providing a specialized Platform as a Service (PaaS) for mobile and web applications.

The following section demonstrates the Firebase services used for the \textit{Beer with Me} PWA.

To use Firebase in a project the following steps need to be performed:
\begin{enumerate}
  \item Register with Firebase
  \item Create a project
\end{enumerate}

\textbf{Authentication and Authorization}

Firebase Auth offers multiple methods to authenticate, including email and password and third-party providers like Google.

\begin{lstlisting}[language=JavaScript, caption=Firebase Auth initiation using VueJS (main.js), label=lst:firebase-auth]
  // Init Firebase auth before Vue inits the App
  firebase.auth.onAuthStateChanged(firebaseUser => {
    if (firebaseUser) {
      store.dispatch("autoSignIn", firebaseUser);
    }
    if (!app) {
      app = new Vue({
        router,
        store,
        render: h => h(App)
      }).$mount("#app");
    }
  });
\end{lstlisting}

\textbf{Realtime Database}
 feeding the feed of posts on the main application page. Map positions
JSON NoSQL

\begin{lstlisting}[language=JavaScript, caption=Realtime query for new posts (Home.vue), label=lst:firebase-listposts]
firebase.db
  .collection("drinks")
  .orderBy("created_at", "desc")
  .onSnapshot(snapShot => {
    this.drinks = [];
    snapShot.forEach(drink => {
      this.drinks.push({
        id: drink.id,
        url: drink.data().url,
        comment: drink.data().comment,
        author: drink.data().author,
        created_at: drink.data().created_at,
      });
    });
  });
\end{lstlisting}

\textbf{Realtime Push Notifications}

Firebase Functions
